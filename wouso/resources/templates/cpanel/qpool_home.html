{% extends 'cpanel/index.html' %}
{% load i18n %}
{% block scripts %}
    <link rel="stylesheet" type="text/css" href="/static/css/tabs.css" />
{% endblock %}

{% block sectiontitle %}Question pool{% endblock %}

{% block sectioncontent %}
<div class="actions">
    <form method="get" action="{% url qpool_search %}">
        <input class="big" type="text" name="q" value="{{q}}" size="80" />
        <button type="submit">{% trans 'Search'%}</button>
    </form>
</div>
<div class="actions">
    <a class="button" href="{% url question_new %}">{% trans 'Add question' %}</a>
    <a class="button" href="{% url importer %}">{% trans 'Import file' %}</a>
    <a class="button" href="{% url tag_questions %}">{% trans 'Tag questions' %}</a>
    <a class="button" href="#">{% trans 'Manage tags' %}</a>
</div>


{% block subsectioncontent %}
<ul class="tabs">
    {% for c in categs %}
    <li {% if cat == c.name %}class="active"{% endif %}><a href="{% url qpool_home c.name %}">{{ c.name|capfirst }}</a></li>
    {% endfor %}

    <li {% if cat == 'search' %}class="active"{% endif %}><a href="{% url qpool_search %}">{% trans 'Search' %}</a></li>
</ul>

<div class="tab_container">
    <div id="tab-1" class="tab_content">
        <div class="spacer"></div>

        <div class="subgroups">
            {% block right-sidebar %}
            <h3>Filters</h3>

            <ul class="simple">
                <li>Tags:</li>
                {% for t in category.tag_set.all %}
                <li>{% if t.id in tag_filters %}
                    <strong><a href="?remtagfilter={{ t.id }}">{{ t }}</a></strong>
                    {% else %}
                    <a href="?addtagfilter={{ t.id }}">{{ t }}</a>
                    {% endif %}
                </li>
                {% empty %}
                <li><em>no tags</em></li>
                {% endfor %}

                <li>Properties</li>
                <li>{% if 'active' in prop_filters %}
                    <strong><a href="?rempropfilter=active">active</a></strong>
                    {% else %}
                    <a href="?addpropfilter=active">active</a>
                    {% endif %}
                </li>
            </ul>
            {% endblock %}
        </div>

        <table>
            <tr>
                {% if cat == 'search' %}
                <th>#</th>
                {% endif %}
                {% if cat == 'qotd' %}
                <th>Day</th>
                {% endif %}
                <th>Question</th>
                {% if cat != 'proposed' %}
                <th>Active</th>
                {% else %}
                <th>Endorsed</th>
                {% endif %}
                <th>Actions</th>
            </th>
        {% for q in q_page.object_list %}
            <tr>
                {% if cat == 'search' %}<td>{{q.id}}</td>{% endif %}
                {% if cat == 'qotd' %}
                <td nowrap {% if q.scheduled == today %}class="bold"{%endif%}>{{ q.scheduled }}</td>
                {% endif %}
                <td>{{ q }}<span class="points">{% if not q.is_valid %}<span class="wrong">Invalid</span>{% endif %}</span>
                    {% if cat != 'proposed'%}
                        <div class="second">{% if q.tag %}tags: {{ q.tag }}{% endif %}</div>
                    {% else %}
                        <div class="second"><p><b>Proposed by</b>: {{q.proposed_by}}</p>
                            <p><b>Endorsed by</b>: {{q.endorsed_by}}</p>
                            <p> <b>Tags</b>: {{ q.tag }}</p></div>
                    {% endif %}
                </td>
                {% if cat != 'proposed' %}
                <td>
                <a class="button button-min" href="{% url switch_active q.id %}">{% if q.active %}<span class="ok">yes</span>
                {% else %}<span class="wrong">no</span>
                {% endif %}
                </a>
                </td>
                {% else %}
                <td>
                <a class="button button-min" href="{% url switch_active q.id %}">{% if q.endorsed_by %}<span class="ok">yes</span>
                {% else %}<span class="wrong">no</span>
                {% endif %}
                </a>
                </td>
                {% endif %}
                <td class="actions" nowrap>
                    <a class="button-min" href="{% url question_edit q.id%}">✍</a>
                    <a class="button-min" href="{% url question_del q.id%}" onclick="return confirm('really?');">✕</a>
                </td>
            </tr>

        {% empty %}
        <tr><td colspan=3>No questions</td></tr>
        {% endfor %}
        <div class="pagination">
            <span class="step-links">
                {% if q_page.has_previous %}
                    <a href="{% url qpool_home cat=cat page=q_page.previous_page_number %}"> &laquo;</a>
                {% endif %}

                <span class="current">
                    Page {{ q_page.number }} of {{ q_page.paginator.num_pages }}.
                </span>

                {% if q_page.has_next %}
                    <a href="{% url qpool_home cat=cat page=q_page.next_page_number %}"> &raquo;</a>
                {% endif %}
            </span>
        </div>
        </table>
    </div> <!-- end tab-content -->
</div> <!-- end tab-container -->
{% endblock %} {# end subsectioncontent #}
{% endblock %}

{% block extra_sidebar %}
    {% if cat == 'qotd' %}
    <ul class="menu no-border">
        <li><a class="button" href="{% url qotd_schedule %}" title="schedule active questions">Automatic schedule</a></li>
    </ul>
    {% endif %}
    {% if cat == 'challenge' %}
    <h3> Active tags </h3>
    {% if tags == 0 %}
    <p>No available tags.</p>
    {% else %}
    <form action="{% url set_active_categories %}" method="post">{% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Submit" />
    </form>
    {% endif %}
    {% endif %}

    {% if cat != 'search' %}
    <ul class="menu no-border">
        <li><a class="button" href="{% url remove_all cat=cat %}" onclick="return confirm('Are you sure?');">Remove all</a></li>
    </ul>
    {% endif %}
{% endblock %}