{% extends 'site_base.html' %}
{% load artifacts %}
{% load user %}

{% block title %}Group: {{ group.name }}{% endblock %}
{% block scripts %}
    <script type="text/javascript" src="/static/js/tabs.js"></script>
    <script type="text/javascript" src="/static/js/jquery.flot.pack.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/tabs.css" />
{% endblock %}

{% block content %}
<div class="profile">
    <div class="points">
        <div class="points-big">{{ group.live_points}}</div>
        <div class="rank">rank: {{ top.position }}</div>
    </div>

    <h2>{{ group }}</h2>
    <h3>{% if group.gclass == 0 %}Group{% else %}
        {% if group.gclass == 1 %}Series{% endif %}
        {% endif %}
        {% if group.parent %}part of {% player_group group.parent %}{% endif %}
    </h3>

    <div class="actions">
    </div>

    <div class="second">
    </div>

    <ul class="tabs">
        <li><a href="#tab-1">Top users</a></li>
        <li><a href="#tab-2">Activity</a></li>
        <li><a href="#tab-3">Evolution</a></li>
    </ul>

    <div class="tab_container">
        <div id="tab-1" class="tab_content">
        {% if group.children %}
        <div class="subgroups">
        <h4>Top subgroups</h4>
        <ol class="top">{% for g in subgroups %}
            <li>{% player_group g %} <span class="points">{{ g.points }}</span></li>
            {% endfor %}
        </ol>
        </div>
        {% endif %}
        
        <ol class="top">
            {% for u in top_users %}
            <li>{% player u %} <span class="points">{{ u.points }}</span></li>
            {% empty %}
            <li class="empty">Sorry, no users in this group</li>
            {% endfor %}
        </ol>
        </div>

        <div id="tab-2" class="tab_content">
        <ul>
        {% for ac in activity.object_list %}
            {% if ac.user_from == ac.user_to %}
                <li> {{ ac.user_from }} <br/>
            {% else %}
                <li> From {{ ac.user_from }} to {{ ac.user_to }} <br/>
            {% endif %}
            <b>{{ ac.message }}</b> <br/>
            {{ ac.timestamp }}<br/></li>
        {% empty %}
            <li class="empty">Sorry, no recent activity for this group</li>
        {% endfor %}
        </ul>
        </div>

        <div id="tab-3" class="tab_content">
            <div id="graf1" class="graf placeholder"></div>
            <script id="source" language="javascript" type="text/javascript">
            <!-- using flot to draw evolution -->
            $(function () {
                var d1 = [[null, 10],{% for p in top.week_evolution %}[{{p.0}},{{p.1}}],{% endfor %}[7, null]];
                var options = { lines: { show: true }, points: { show: true },
                    xaxis: {
                        ticks: [[1,1],[5,5],[9,9]]
                        }
                };
                $("#tab-3").bind('custom', function() {
                    $.plot($("#graf1"), [{ label: "Weekly position evolution", color: "green", data: d1}], options);
                    $('#tab-3').unbind('custom');
                });
            });
            </script>
        </div>
    </div>
</div>
{% endblock %}
