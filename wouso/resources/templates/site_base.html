{% load user %}
{% load artifacts %}
{% load i18n %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>{% block title %}{{config_title}}{% endblock %}</TITLE>
<LINK rel="stylesheet" type="text/css" href="/static/css/style.css" />
<LINK rel="stylesheet" type="text/css" href="/static/themes/{{ config_theme }}/styles.css" />
<style type="text/css">
    @import url("/static/css/autocomplete.css");
    {% if config_logo %}
    div#logo {
        background: url({{ config_logo}}) no-repeat;
    }
    {% endif %}
    {% block css %}{% endblock %}
</style>
<script type="text/javascript" src="/static/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/format.item.js"></script>
{% block scripts %}{% endblock %}
</HEAD>

<BODY>
<div id="container">
    <div id="header">
        <div id="topbar">
            {% if user.is_authenticated %}
                <span class="bold">{% player user.get_profile %}</span> |
                {% autoescape off %}{{ header }}{% endautoescape %}
                {% if user.is_staff %}
                <a href="{% url wouso.interface.cpanel.views.dashboard %}">CPanel</a> |
                {% endif %}
                <a href="{% url django.contrib.auth.views.logout %}">{% trans "Logout" %} &raquo;</a>
            {% else %}
            {% trans 'Anonimous' %}, <a href="{% url django.contrib.auth.views.login %}">{% trans "Login" %} &raquo;</a>
            {% endif %}
        </div>
        <div id="logo">
            <a href="{% url interface.views.homepage %}" id="logoa"></a>
        </div>
    </div>

    {% block search %}
    <div id="search">
        <form method="post" action="/search/" style="float:right;">
            <input id="query" type="text" name="query" size="10" />
            <button type=submit>{% trans 'Search' %}</button>
        </form>
        <script type="text/javascript">
            $(document).ready(function() {
            $("#query").autocomplete("/instantsearch/", { minChars:3, matchSubset:1, matchContains:1, cacheLength:10, formatItem:formatItem, onItemSelect:selectItem, selectOnly:1 });
            });
        </script>
    </div>
    {% endblock %}

    <div id="sidebar">
        {% block sidebar %}
        {% for w in sidebar %}
            {{ w }}
        {% endfor %}
        {% endblock %}
        {% if last10 %}
        <h2>{% trans 'Online players' %}</h2>
            {% for u in last10 %}
                {% player u %}
            {% endfor %}
        {% endif %}
    </div>

    <div id="content">
        <div id="ajax-message"></div>
    {% if is_homepage %}
    <div id="right-sidebar">
        <h2>{{ user.get_profile }}</h2>
        <div class="centered">
            <img src="{% player_avatar user.get_profile %}" class="avatar no-float" />
            <h4>{% artifact user.get_profile.level %} {{ user.get_profile.level.title }}</h4>
            <span>{{ user.get_profile.points }} p</span>
            <!-- TODO progress bar points in level, next level -->
            <br/>
            <span>{{ user.get_profile.level_progress.points_left }} left to advance</span>
        </div>
        <h3>{% trans 'Your rank' %}</h3>
        <p>{% trans 'Global' %}: <span class="points">{{ top.position }}</span></p>
        {% for g in topgroups %}
        <p>{{ g }}: <span class="points">{{ g.position }}</span></p>
        {% endfor %}

        <h3>{% trans 'Artifacts' %}</h3>
        {% for a in user.get_profile.artifact_amounts.all %}
            {% artifact a %}
        {% empty %}
        {% trans 'None.' %}
        {% endfor %}
        <h3>{% trans 'Spells' %}</h3>
        Available:
        {% for s in user.get_profile.spell_amounts.all %}
            {% artifact s %}
        {% empty %}
        {% trans 'None.' %}
        {% endfor %} <br/>
        Cast on me:
        {% for s in user.get_profile.spells %}
            {% spell_due s %}
        {% empty %}
        {% trans 'None.' %}
        {% endfor %} <br/>
        <div class="right">
            <a href="{% url magic_summary %}">{% trans 'Summary' %}</a>
            <a href="{% url market_home %}">{% trans 'Market' %}</a>
        </div>
    </div>
    {% endif %}
    {% block content %}
    <div id="wall">
        <h2>{% trans 'Activity' %}</h2>
        {% include 'activity/stream.html' %}

        {% if activity.has_previous %}
            <a href="{% url wouso.interface.views.homepage %}"> &raquo; </a>
        {% endif %}

        {% if activity.has_next %}
            <a href="{% url wouso.interface.views.homepage page=activity.next_page_number %}"> &laquo;</a>
        {% endif %}
    </div>
    {% endblock %}
    </div>

    <div id="footer">
        <div id="footer_links">{% autoescape off %}{{ footer }}{% endautoescape %}
        <br/>
        <span id="poweredby">
        <br />{% trans 'Powered by:' %}<br />
        <a href="http://www.rosedu.org/"></a>
        </span>
        </div>
    </div>
    {{ config_hidden_footer }}
</BODY>
</HTML>
